= render :partial => "layouts/flash_msg"
- if @edit && @edit[:current]
  = render :partial => "cb_rate_edit"
- else
  %h3= _('Basic Info')
  .form-horizontal.static
    .form-group
      %label.col-md-2.control-label
        = _('Description')
      .col-md-8
        %p.form-control-static
          = h(@record.description)
  %hr
  %h3= _('Rate Details')
  %ul.nav.nav-tabs
    - if @sb[:date_ranges].empty?
      %li.active{ :role => "presentation" }
        %a= _('Active all the Time')
    - else
      - @sb[:date_ranges].each_with_index do |dr, i|
        - if dr[:current]
          %li.active{ :role => "presentation" }
            %a= _("from #{dr[:start_date]} to #{dr[:end_date]}")
        - else
          %li{ :role => "presentation" }
            = link_to(_("from #{dr[:start_date]} to #{dr[:end_date]}"),
                      url_for(:action => 'tree_select', :id => "xx-#{@record.rate_type}_cr-#{@record.id}", :date_range => i),
                      :remote                => true,
                      "data-method"          => :post)

  %table.table.table-bordered
    %thead
      %tr
        %th= _('Group')
        %th= _('Description')
        %th= _('Rate')
        %th= _('Per Time')
        %th= _('Per Unit')
    %tbody
      - if !@sb[:date_ranges].empty?
        -  @sb[:selected_rate_details] =  @sb[:selected_rate_details].select { |rd| rd[:start_date].strftime("%m/%d/%Y") == @sb[:date_ranges][@sb[:selected_date_range]][:start_date] }
      - @sb[:selected_rate_details].each do |r|
        - @cur_group = r[:group] if @cur_group.nil?
        - if @cur_group != r[:group]
          - @cur_group = r[:group]
          %tr
            %td.active{:colspan => "6"} &nbsp;
        %tr
          %td
            = h(rate_detail_group(r[:group]))
          %td
            = r[:description]
          %td{:align => "right"}
            = r[:rate]
          %td
            = r[:per_time]
          %td
            = r.per_unit_display
